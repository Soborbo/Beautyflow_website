---
// CSS import with URL for async loading
import cssUrl from '../styles/global.css?url';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import StickyMobileCTA from '../components/StickyMobileCTA.astro';
import { getLangFromUrl, useTranslations, getAlternateRoute, type Locale } from '../i18n';

interface Props {
  title: string;
  description?: string;
  lang?: Locale;
  translationOf?: string;
}

const currentLang = Astro.props.lang || getLangFromUrl(Astro.url);
const t = useTranslations(currentLang);

const defaultDescription = t('meta.defaultDescription');
const siteName = t('meta.siteName');

const { title, description = defaultDescription, translationOf } = Astro.props;

const ogLocale = currentLang === 'hu' ? 'hu_HU' : 'en_US';
const currentUrl = Astro.url.pathname;

// Generate proper hreflang URLs using route mappings
const pathWithoutLang = currentUrl.replace(/^\/(en)/, '') || '/';
const huUrl = getAlternateRoute(pathWithoutLang, currentLang, 'hu');
const enUrl = getAlternateRoute(pathWithoutLang, currentLang, 'en');
const canonicalUrl = `https://beautyflow.pro${currentUrl}`;
const xDefaultUrl = `https://beautyflow.pro${huUrl}`;
---

<!DOCTYPE html>
<html lang={currentLang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/png" href="/images/Beautyflow-favicon.png" />
    <title>{title}</title>

    <link rel="canonical" href={canonicalUrl} />

    <!-- Alternate language links for SEO -->
    <link rel="alternate" hreflang="hu" href={`https://beautyflow.pro${huUrl}`} />
    <link rel="alternate" hreflang="en" href={`https://beautyflow.pro${enUrl}`} />
    <link rel="alternate" hreflang="x-default" href={xDefaultUrl} />

    <!-- Critical CSS - inline for fast first paint -->
    <style is:inline>
      /* Critical layout */
      *,::before,::after{box-sizing:border-box}
      html{font-family:'Open Sans',sans-serif;font-size:15px;line-height:1.65;color:#334155}
      body{margin:0;min-height:100vh;display:flex;flex-direction:column;overflow-x:hidden}
      h1,h2,h3{font-family:Cormorant,serif;color:#1e293b;font-weight:700;margin:0}
      img{max-width:100%;height:auto}

      /* Critical header */
      .header-nav{position:fixed;top:0;left:0;right:0;z-index:50;background:white}

      /* Critical hero colors */
      .bg-\[\#fff9f7\]{background-color:#fff9f7}
      .bg-\[\#c53f75\]{background-color:#c53f75}
      .text-\[\#c53f75\]{color:#c53f75}
      .text-white{color:white}
      .text-gray-900{color:#111827}
      .text-gray-600{color:#4b5563}
      .text-gray-500{color:#6b7280}

      /* Critical flex/grid */
      .flex{display:flex}
      .flex-col{flex-direction:column}
      .flex-grow{flex-grow:1}
      .items-center{align-items:center}
      .justify-center{justify-content:center}
      .text-center{text-align:center}
      .relative{position:relative}
      .absolute{position:absolute}
      .inset-0{inset:0}
      .w-full{width:100%}
      .h-full{height:100%}
      .object-cover{object-fit:cover}
      .hidden{display:none}
      .uppercase{text-transform:uppercase}
      .font-bold{font-weight:700}
      .rounded-full{border-radius:9999px}
      .shadow-lg{box-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1)}
      .overflow-hidden{overflow:hidden}
      .gap-2{gap:0.5rem}
      .gap-3{gap:0.75rem}
      .mb-1{margin-bottom:0.25rem}
      .mb-3{margin-bottom:0.75rem}
      .mb-4{margin-bottom:1rem}
      .mb-5{margin-bottom:1.25rem}
      .mb-6{margin-bottom:1.5rem}
      .py-3{padding-top:0.75rem;padding-bottom:0.75rem}
      .py-4{padding-top:1rem;padding-bottom:1rem}
      .py-8{padding-top:2rem;padding-bottom:2rem}
      .px-4{padding-left:1rem;padding-right:1rem}
      .px-5{padding-left:1.25rem;padding-right:1.25rem}

      /* Critical responsive */
      @media(min-width:1024px){
        .lg\:flex{display:flex}
        .lg\:hidden{display:none}
        .lg\:flex-row{flex-direction:row}
        .lg\:w-1\/2{width:50%}
        .lg\:h-\[100dvh\]{height:100dvh}
        .lg\:-mt-\[60px\]{margin-top:-60px}
        .lg\:pt-\[80px\]{padding-top:80px}
      }
    </style>

    <!-- Non-blocking CSS - loads after critical CSS -->
    <link rel="preload" href={cssUrl} as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href={cssUrl} /></noscript>

    <!-- Open Graph -->
    <meta property="og:locale" content={ogLocale} />
    <meta property="og:locale:alternate" content={currentLang === 'hu' ? 'en_US' : 'hu_HU'} />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:image" content="https://beautyflow.pro/images/beautyflow-fb.jpg" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
  </head>
  <body class="min-h-screen flex flex-col overflow-x-hidden">
    <Header lang={currentLang} />
    <main class="flex-grow">
      <slot />
    </main>
    <Footer lang={currentLang} />
    <StickyMobileCTA lang={currentLang} />
  </body>
</html>
