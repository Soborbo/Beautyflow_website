---
import { Picture } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  image: ImageMetadata;
  alt: string;
  class?: string;
  priority?: boolean;
  maxWidth?: number;
  aspectRatio?: string;
}

const {
  image,
  alt,
  class: className,
  priority = false,
  maxWidth = 800,
  aspectRatio
} = Astro.props;

// Calculate responsive widths based on maxWidth
const widths = maxWidth >= 1000
  ? [400, 600, 800, 1000]
  : maxWidth >= 600
    ? [300, 450, 600, 800]
    : [200, 300, 400, 600];
---

<Picture
  src={image}
  widths={widths}
  sizes={`(max-width: 640px) 100vw, (max-width: 1024px) 80vw, ${maxWidth}px`}
  formats={['avif', 'webp']}
  quality={75}
  alt={alt}
  class:list={['content-image', className]}
  loading={priority ? 'eager' : 'lazy'}
  fetchpriority={priority ? 'high' : 'auto'}
  decoding="async"
  style={aspectRatio ? `aspect-ratio: ${aspectRatio}` : undefined}
/>

<style>
  .content-image {
    width: 100%;
    height: auto;
  }
</style>
